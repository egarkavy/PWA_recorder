import{c as Me}from"./chunk-5XUPTEYM.js";import"./chunk-3YLBV4VX.js";import{a as Re,b as Pe,d as Ce,e as be,f as Be,h as Fe,i as we}from"./chunk-RAV5WDMC.js";import{b as me,c as ue,g as ge,i as fe,k as he,l as ve,m as _e,n as ye,o as Se}from"./chunk-YF42NFGH.js";import{a as de}from"./chunk-222CUUGD.js";import{a as w,c as M,e as se,f as ce,g as pe,h as le,j as T}from"./chunk-X65V2RTM.js";import{F as h,H as re,S as I,T as ae,V as oe,a as S,z as F}from"./chunk-HKA473OH.js";import{d as ne}from"./chunk-JY5QF2BW.js";import{$ as D,$a as H,Ab as y,Fa as d,Ja as R,Kb as X,Ob as Y,Pb as Z,Qa as m,Qb as ee,Ta as O,Ua as z,Va as P,Xa as c,Ya as u,Yb as te,Za as v,_a as j,_b as ie,bb as U,c as q,da as r,ea as V,fb as x,hb as _,ja as N,ka as Q,kb as K,lb as g,m as E,mb as L,nb as G,pb as J,qb as W,sb as a,tb as p,ub as f,wb as C,xb as b,zb as B}from"./chunk-ESE33L4O.js";var A=(()=>{let t=class t{constructor(){this.destroyRef=r(R),this.recordingFacade=r(M),this.recordingActionsFacade=r(T),this.stopwatchService=r(F),this.timePassed$=this.stopwatchService.timePassed$}track(){this.recordingFacade.state$.pipe(S(this.destroyRef)).subscribe(s=>{s===w.Playing?this.stopwatchService.start():this.stopwatchService.stop()}),this.recordingActionsFacade.reset$.pipe(S(this.destroyRef)).subscribe(()=>{this.stopwatchService.stopAndReset()})}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=D({token:t,factory:t.\u0275fac});let e=t;return e})();var ke=["recordingButtonPortal"],$e=["pageTitlePortal"],qe=["backButtonPortal"];function xe(e,t){if(e&1&&(j(0),v(1,"common-audio-stream-visualizer",13),a(2,"async"),a(3,"equal"),a(4,"async"),H()),e&2){let l=_();d(),m("bgColor","#f1ecf9")("curveColor","#5a43d9")("stream",p(2,4,l.recordingStream$))("visualize",f(3,6,p(4,9,l.recordingState$),l.RecordingState.Playing))}}function Ie(e,t){if(e&1){let l=U();c(0,"button",14),x("click",function(){N(l);let o=_();return Q(o.onBack())}),c(1,"mat-icon"),g(2,"arrow_back"),u()()}}function Ae(e,t){e&1&&(c(0,"mat-icon",16),g(1,"radio_button_checked"),u()),e&2&&m("@fadeIf",void 0)}function Ee(e,t){if(e&1&&(P(0,Ae,2,1,"mat-icon",15),a(1,"equal"),a(2,"async")),e&2){let l=_();m("ngIf",f(1,1,p(2,4,l.recordingState$),l.RecordingState.Playing))}}function De(e,t){if(e&1&&(c(0,"span",17),g(1),a(2,"async"),u()),e&2){let l=_();d(),G("",p(2,1,l.patientName$)," - New Transcript")}}function Ve(e,t){e&1&&(c(0,"div",18),v(1,"mat-spinner",19),g(2," Submitting... "),u()),e&2&&(d(),m("diameter",50))}var Ft=(()=>{let t=class t{constructor(){this.hostClass="flex-all-available-space",this.viewContainerRef=r(z),this.recordingFacade=r(M),this.recordingTimeFacadeService=r(A),this.toolbarBridgeService=r(de),this.confirmModalService=r(pe),this.recordingActionsFacade=r(T),this.destroyRef=r(R),this.router=r(ie),this.activatedRoute=r(te),this.audioService=r(I),this.appFacade=r(Me),this.recordingState$=this.recordingFacade.state$,this.pending$=this.recordingFacade.pending$,this.dateStart$=this.recordingFacade.dateStart$,this.timePassed$=this.recordingTimeFacadeService.timePassed$,this.patientName$=E("Mr. Doner Kebab"),this.recordingStream$=this.audioService.started$,this.titleControl=new he("",{nonNullable:!0}),this.RecordingState=w,this.allowSave=!1}ngOnInit(){this.appFacade.preventScrolling(),this.recordingTimeFacadeService.track(),this.play(),this.watchTitleChanges(),this.audioService.stopped$.subscribe(s=>{this.allowSave&&this.recordingFacade.submitRecording(s)}),this.recordingActionsFacade.submitRecordingSuccess$.pipe(S(this.destroyRef)).subscribe(()=>{this.router.navigate([".."],{relativeTo:this.activatedRoute})})}ngAfterViewInit(){this.backButtonPortal&&this.toolbarBridgeService.setToolbarLeftPortal(this.backButtonPortal),this.pageTitlePortal&&this.toolbarBridgeService.setToolbarMiddlePortal(this.pageTitlePortal),this.recordingButtonPortal&&this.toolbarBridgeService.setToolbarRightPortal(this.recordingButtonPortal)}pause(){this.recordingFacade.pause(),this.audioService.pause()}resume(){this.recordingFacade.resume(),this.audioService.resume()}delete(){this.confirmModalService.whenConfirmed("Delete this transcript?","This cannot be undone").subscribe(()=>q(this,null,function*(){this.recordingFacade.cancel(),this.allowSave=!1,this.audioService.stop(),yield this.onBack()}))}save(){this.recordingFacade.stop(),this.allowSave=!0,this.audioService.stop()}play(){this.recordingFacade.start(),this.audioService.record()}watchTitleChanges(){this.titleControl.valueChanges.subscribe(s=>{this.recordingFacade.setTitle(s)})}ngOnDestroy(){this.backButtonPortal?.detach(),this.pageTitlePortal?.detach(),this.recordingButtonPortal?.detach(),this.toolbarBridgeService.resetAll(),this.recordingFacade.resetState(),this.allowSave=!1,this.audioService.stop(),this.appFacade.allowScrolling()}onBack(){return q(this,null,function*(){yield this.router.navigate([".."],{relativeTo:this.activatedRoute})})}};t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=V({type:t,selectors:[["pyp-patient-recording"]],viewQuery:function(o,i){if(o&1&&(b(ke,5,h),b($e,5,h),b(qe,5,h)),o&2){let n;C(n=B())&&(i.recordingButtonPortal=n.first),C(n=B())&&(i.pageTitlePortal=n.first),C(n=B())&&(i.backButtonPortal=n.first)}},hostVars:2,hostBindings:function(o,i){o&2&&O(i.hostClass)},standalone:!0,features:[J([A,F,I]),W],decls:27,vars:29,consts:[[1,"m-4","p-4","mat-elevation-z0"],["appearance","outline"],["matInput","","placeholder","Add Title",3,"formControl"],[1,"flex-all-available-space","my-4"],[4,"ngIf","ngIfElse"],[1,"bottom-0","sticky","flex","flex-col"],[1,"my-4",3,"time","onRec"],[3,"state","disable","deleteRequest","resumeRequest","pauseRequest","saveRequest","playRequest"],["cdkPortal",""],["backButtonPortal",""],["recordingButtonPortal",""],["pageTitlePortal",""],["spinnerTemplate",""],[3,"bgColor","curveColor","stream","visualize"],["mat-icon-button","","aria-label","Navigate back",3,"click"],["class","record-indicator shrink-0","color","warn",4,"ngIf"],["color","warn",1,"record-indicator","shrink-0"],[1,"line-clamp-2","whitespace-normal"],[1,"flex","flex-col","items-center","m-auto"],[3,"diameter"]],template:function(o,i){if(o&1&&(c(0,"mat-card",0)(1,"mat-form-field",1),v(2,"input",2),u(),c(3,"span"),g(4),a(5,"date"),a(6,"async"),u()(),c(7,"div",3),P(8,xe,5,11,"ng-container",4),a(9,"equal"),a(10,"async"),u(),c(11,"div",5),v(12,"pyp-record-timer",6),a(13,"async"),a(14,"equal"),a(15,"async"),c(16,"pyp-player-navigator",7),x("deleteRequest",function(){return i.delete()})("resumeRequest",function(){return i.resume()})("pauseRequest",function(){return i.pause()})("saveRequest",function(){return i.save()})("playRequest",function(){return i.play()}),a(17,"async"),a(18,"async"),u()(),P(19,Ie,3,0,"ng-template",8,9,y)(21,Ee,3,6,"ng-template",8,10,y)(23,De,3,3,"ng-template",8,11,y)(25,Ve,3,1,"ng-template",null,12,y)),o&2){let n=K(26),k,$;d(2),m("formControl",i.titleControl),d(2),L(f(5,8,p(6,11,i.dateStart$),"h:mm MM/dd/yyyy")),d(4),m("ngIf",f(9,13,p(10,16,i.pending$),!1))("ngIfElse",n),d(4),m("time",(k=p(13,18,i.timePassed$))!==null&&k!==void 0?k:"")("onRec",f(14,20,p(15,23,i.recordingState$),i.RecordingState.Playing)),d(4),m("state",($=p(17,25,i.recordingState$))!==null&&$!==void 0?$:i.RecordingState.Idle)("disable",p(18,27,i.pending$))}},dependencies:[ee,X,Y,Z,Re,Pe,Be,be,ue,me,Se,ye,ae,re,h,ce,se,Ce,we,Fe,le,_e,ge,fe,ve,ne],styles:["[_nghost-%COMP%]{background-color:#f1ecf9}.wait[_nghost-%COMP%]{background-color:#ddd8e5}@keyframes _ngcontent-%COMP%_recordingAnimation{0%{opacity:1}50%{opacity:0}to{opacity:1}}.record-indicator[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_recordingAnimation 3s infinite}"],data:{animation:[oe]},changeDetection:0});let e=t;return e})();export{Ft as PatientRecordingComponent};
