import{c as Fe}from"./chunk-2GR3IA5Z.js";import"./chunk-FZVX62TG.js";import{a as ve,b as ye,d as _e,e as Se,f as Re,h as Ce,i as Te}from"./chunk-LHRYJLCQ.js";import{b as pe,c as ce,g as de,i as le,k as me,l as ue,m as ge,n as fe,o as he}from"./chunk-XQD7CUYD.js";import{a as se}from"./chunk-3H7GWFCG.js";import{a as T,b as F,d as re,e as ae,f as ne,g as oe,i as P}from"./chunk-HXNQIXC2.js";import{D as I,G as ee,R as A,S as te,U as ie,a as v,z as C}from"./chunk-N5OPLCCF.js";import"./chunk-BDQICLCY.js";import{$ as E,$a as V,Ab as R,Fa as c,Ja as y,Kb as J,Ob as L,Pb as W,Qa as d,Qb as X,Ta as N,Ua as O,Va as _,Xa as l,Ya as u,Yb as Y,Za as f,_a as Q,_b as Z,da as r,ea as k,fb as z,hb as S,kb as j,lb as h,m as D,mb as H,nb as U,pb as K,qb as G,sb as a,tb as p,ub as g,vb as M,wb as B,xb as $,zb as q}from"./chunk-5ARDGOVG.js";var x=(()=>{let t=class t{constructor(){this.destroyRef=r(y),this.recordingFacade=r(F),this.recordingActionsFacade=r(P),this.stopwatchService=r(C),this.timePassed$=this.stopwatchService.timePassed$}track(){this.recordingFacade.state$.pipe(v(this.destroyRef)).subscribe(n=>{n===T.Playing?this.stopwatchService.start():this.stopwatchService.stop()}),this.recordingActionsFacade.reset$.pipe(v(this.destroyRef)).subscribe(()=>{this.stopwatchService.stopAndReset()})}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=E({token:t,factory:t.\u0275fac});let e=t;return e})();var be=["recordingButtonTemplate"],we=["pageTitleTemplate"];function Me(e,t){if(e&1&&(Q(0),f(1,"common-audio-stream-visualizer",11),a(2,"async"),a(3,"equal"),a(4,"async"),V()),e&2){let m=S();c(),d("bgColor","#f1ecf9")("curveColor","#5a43d9")("stream",p(2,4,m.recordingStream$))("visualize",g(3,6,p(4,9,m.recordingState$),m.RecordingState.Playing))}}function Be(e,t){e&1&&(l(0,"mat-icon",13),h(1,"radio_button_checked"),u()),e&2&&d("@fadeIf",void 0)}function $e(e,t){if(e&1&&(_(0,Be,2,1,"mat-icon",12),a(1,"equal"),a(2,"async")),e&2){let m=S();d("ngIf",g(1,1,p(2,4,m.recordingState$),m.RecordingState.Playing))}}function qe(e,t){if(e&1&&(l(0,"span",14),h(1),a(2,"async"),u()),e&2){let m=S();c(),U("",p(2,1,m.patientName$)," - New Transcript")}}function Ie(e,t){e&1&&(l(0,"div",15),f(1,"mat-spinner",16),h(2," Submitting... "),u()),e&2&&(c(),d("diameter",50))}var yt=(()=>{let t=class t{constructor(){this.hostClass="flex-all-available-space",this.viewContainerRef=r(O),this.recordingFacade=r(F),this.recordingTimeFacadeService=r(x),this.toolbarBridgeService=r(se),this.confirmModalService=r(ne),this.recordingActionsFacade=r(P),this.destroyRef=r(y),this.router=r(Z),this.activatedRoute=r(Y),this.audioService=r(A),this.appFacade=r(Fe),this.recordingState$=this.recordingFacade.state$,this.pending$=this.recordingFacade.pending$,this.dateStart$=this.recordingFacade.dateStart$,this.timePassed$=this.recordingTimeFacadeService.timePassed$,this.patientName$=D("Mr. Doner Kebab"),this.recordingStream$=this.audioService.started$,this.titleControl=new me("",{nonNullable:!0}),this.RecordingState=T,this.allowSave=!1}ngOnInit(){this.appFacade.preventScrolling(),this.recordingTimeFacadeService.track(),this.play(),this.watchTitleChanges(),this.audioService.stopped$.subscribe(n=>{this.allowSave&&this.recordingFacade.submitRecording(n)}),this.recordingActionsFacade.submitRecordingSuccess$.pipe(v(this.destroyRef)).subscribe(()=>{this.router.navigate([".."],{relativeTo:this.activatedRoute})})}ngAfterViewInit(){if(this.recordingButtonTemplate){let n=new I(this.recordingButtonTemplate,this.viewContainerRef);this.toolbarBridgeService.setToolbarRightPortal(n)}if(this.pageTitleTemplate){let n=new I(this.pageTitleTemplate,this.viewContainerRef);this.toolbarBridgeService.setToolbarMiddlePortal(n)}}pause(){this.recordingFacade.pause(),this.audioService.pause()}resume(){this.recordingFacade.resume(),this.audioService.resume()}delete(){this.confirmModalService.whenConfirmed("Delete this transcript?","This cannot be undone").subscribe(()=>{this.recordingFacade.reset(),this.allowSave=!1,this.audioService.stop()})}save(){this.recordingFacade.stop(),this.allowSave=!0,this.audioService.stop()}play(){this.recordingFacade.start(),this.audioService.record()}watchTitleChanges(){this.titleControl.valueChanges.subscribe(n=>{this.recordingFacade.setTitle(n)})}ngOnDestroy(){this.toolbarBridgeService.resetAll(),this.recordingFacade.resetState(),this.allowSave=!1,this.audioService.stop(),this.appFacade.allowScrolling()}};t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=k({type:t,selectors:[["pyp-patient-recording"]],viewQuery:function(o,i){if(o&1&&($(be,5,M),$(we,5,M)),o&2){let s;B(s=q())&&(i.recordingButtonTemplate=s.first),B(s=q())&&(i.pageTitleTemplate=s.first)}},hostVars:2,hostBindings:function(o,i){o&2&&N(i.hostClass)},standalone:!0,features:[K([x,C,A]),G],decls:25,vars:29,consts:[[1,"m-4","p-4","mat-elevation-z0"],["appearance","outline"],["matInput","","placeholder","Add Title",3,"formControl"],[1,"flex-all-available-space","my-4"],[4,"ngIf","ngIfElse"],[1,"bottom-0","sticky","flex","flex-col"],[3,"time","onRec"],[3,"state","disable","deleteRequest","resumeRequest","pauseRequest","saveRequest","playRequest"],["recordingButtonTemplate",""],["pageTitleTemplate",""],["spinnerTemplate",""],[3,"bgColor","curveColor","stream","visualize"],["class","record-indicator shrink-0","color","warn",4,"ngIf"],["color","warn",1,"record-indicator","shrink-0"],[1,"line-clamp-2","whitespace-normal"],[1,"flex","flex-col","items-center","m-auto"],[3,"diameter"]],template:function(o,i){if(o&1&&(l(0,"mat-card",0)(1,"mat-form-field",1),f(2,"input",2),u(),l(3,"span"),h(4),a(5,"date"),a(6,"async"),u()(),l(7,"div",3),_(8,Me,5,11,"ng-container",4),a(9,"equal"),a(10,"async"),u(),l(11,"div",5),f(12,"pyp-record-timer",6),a(13,"async"),a(14,"equal"),a(15,"async"),l(16,"pyp-player-navigator",7),z("deleteRequest",function(){return i.delete()})("resumeRequest",function(){return i.resume()})("pauseRequest",function(){return i.pause()})("saveRequest",function(){return i.save()})("playRequest",function(){return i.play()}),a(17,"async"),a(18,"async"),u()(),_(19,$e,3,6,"ng-template",null,8,R)(21,qe,3,3,"ng-template",null,9,R)(23,Ie,3,1,"ng-template",null,10,R)),o&2){let s=j(24),b,w;c(2),d("formControl",i.titleControl),c(2),H(g(5,8,p(6,11,i.dateStart$),"h:mm MM/dd/yyyy")),c(4),d("ngIf",g(9,13,p(10,16,i.pending$),!1))("ngIfElse",s),c(4),d("time",(b=p(13,18,i.timePassed$))!==null&&b!==void 0?b:"")("onRec",g(14,20,p(15,23,i.recordingState$),i.RecordingState.Playing)),c(4),d("state",(w=p(17,25,i.recordingState$))!==null&&w!==void 0?w:i.RecordingState.Idle)("disable",p(18,27,i.pending$))}},dependencies:[X,J,L,W,ve,ye,Re,Se,ce,pe,he,fe,te,ee,ae,re,_e,Te,Ce,oe,ge,de,le,ue],styles:["[_nghost-%COMP%]{background-color:#f1ecf9}.wait[_nghost-%COMP%]{background-color:#ddd8e5}@keyframes _ngcontent-%COMP%_recordingAnimation{0%{opacity:1}50%{opacity:0}to{opacity:1}}.record-indicator[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_recordingAnimation 3s infinite}"],data:{animation:[ie]},changeDetection:0});let e=t;return e})();export{yt as PatientRecordingComponent};
